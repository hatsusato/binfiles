#!/bin/bash

set -eu

usage() {
  local prefix=${XDB_RUNTIME_DIR-/run/user/$UID}
  cat <<EOF >&2
USAGE: $0 PATH
    Create a directory under $prefix and echo its path

    PATH  relative path from $prefix
EOF
  exit 1
}
make-dir() {
  [[ $1 == $prefix ]] && return
  make-dir "${1%/*}"
  mkdir -m700 -p "$1"
}
main() {
  local prefix=${XDB_RUNTIME_DIR-/run/user/$UID}
  local dir=$prefix/$1
  make-dir "$dir"
  echo "$dir"
}

(($# == 1)) || usage
main "$@"
