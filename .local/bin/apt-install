#!/bin/bash

set -eu

apt-install() {
  (($#)) || exit
  local -i n=$(dpkg --no-pager -l "$@" 2>/dev/null | grep ^ii | wc -l)
  (($# == n)) && exit
  sudo apt install "$@"
}
append() {
  local pkg log=$HOME/.config/local/.install
  if [[ ! -f $log ]]; then
    mkdir -p "${log%/*}"
    touch "$log"
  fi
  for pkg; do
    grep -xq "$pkg" "$log" &>/dev/null && continue
    echo "$pkg"
  done >>"$log"
}
main() {
  local opt
  for opt; do
    if [[ $opt == -* ]]; then
      echo "ERROR: $opt cannot be used" >&2
      exit 1
    fi
  done
  apt-install "$@"
  append "$@"
}

main "$@"
