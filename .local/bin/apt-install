#!/bin/bash

set -eu

apt-install() {
  (($# == 0)) && exit
  local -i n=$(dpkg --no-pager -l "$@" 2>/dev/null | grep ^ii | wc -l)
  (($# == n)) && exit
  sudo apt install "$@"
}
append() {
  local pkg log=$HOME/.config/local/.install
  if [[ ! -f $log ]]; then
    mkdir -p "${log%/*}"
    touch "$log"
  fi
  for pkg; do
    grep -xq "$pkg" "$log" &>/dev/null && continue
    echo "$pkg"
  done >>"$log"
}
has-option() {
  local opt
  for opt; do
    [[ $opt == -* ]] && return
  done
  return 1
}
main() {
  if has-option "$@"; then
    sudo apt install "$@"
  else
    apt-install "$@"
    append "$@"
  fi
}

main "$@"
