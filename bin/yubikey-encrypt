#!/bin/bash

set -eu

usage() {
  echo "USAGE: $0 PLAINTEXT CIPHERTEXT" >&2
  exit 1
}
main() {
  local keyid=$(yubikey-init)
  [[ -n $keyid ]] || exit
  local -a gpg=(gpg)
  gpg+=(--armor)
  gpg+=(--output "$2")
  gpg+=(--recipient "$keyid")
  gpg+=(--trusted-key "$keyid")
  gpg+=(--encrypt "$1")
  "${gpg[@]}"
}

(($# == 2)) || usage
main "$@"
