#!/bin/bash

set -eu

clean() {
  kill $pid 2>/dev/null
}

xkb-notify & pid=$!
trap clean EXIT
while kill -n0 $pid 2>/dev/null; do
  wait $pid || (($? == 138)) || exit
  xkb-load || :
  sleep 1
done
