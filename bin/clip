#!/bin/bash

set -eu

clip() {
  xclip -selection clipboard "$@"
}

if [[ ${1-} != -s ]]; then
  clip "$@"
  exit
fi
shift
uuid=56073f53-2dec-4232-a1ac-63f2d4c16e80
if pkill -f ^$uuid; then
  sleep 0.1
fi
content=$(cat "$@" | base64)
before=$(clip -o | base64)
echo "$content" | base64 -d | clip
(
  (exec -a $uuid sleep 30) &
  wait
  now=$(clip -o | base64)
  [[ $now == "$content" ]] || return 0
  echo "$before" | base64 -d | clip
) &
